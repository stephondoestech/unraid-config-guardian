#!/bin/bash

# Pre-push hook to auto-format code before pushing
# This prevents linting-related commits by fixing formatting issues automatically

echo "ğŸ” Running pre-push formatting check..."

# Check if we have uncommitted changes
if ! git diff --quiet || ! git diff --cached --quiet; then
    echo "âš ï¸  You have uncommitted changes. Please commit or stash them first."
    exit 1
fi

# Run format-fix to clean up any formatting issues
echo "ğŸ”§ Auto-fixing formatting issues..."
make format-fix

# Check if format-fix made any changes
if ! git diff --quiet; then
    echo "âœ… Formatting issues were fixed automatically"
    echo "ğŸ“ Staging and committing formatting changes..."

    # Stage the formatting changes
    git add -A

    # Commit the formatting fixes
    git commit -m "Auto-fix formatting before push

    echo "âœ… Formatting fixes committed successfully"
else
    echo "âœ… No formatting issues found"
fi

echo "ğŸš€ Proceeding with push..."
exit 0
